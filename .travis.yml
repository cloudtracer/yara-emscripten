language: generic
dist: xenial
script:
  # Install Python
  - sudo apt-get install python2.7
  # Install node.js
  - sudo apt-get install nodejs
  # Install CMake (optional, only needed for tests and building Binaryen)
  - sudo apt-get install cmake
  # Install Java (optional, only needed for Closure Compiler minification)
  - sudo apt-get install default-jre
  # Get the emsdk repo
  - git clone https://github.com/emscripten-core/emsdk.git
  # Enter that directory
  - cd emsdk
  # Fetch the latest version of the emsdk (not needed the first time you clone)
  # - git pull
  # Download and install the latest SDK tools.
  - ./emsdk install latest
  # Make the "latest" SDK "active" for the current user. (writes ~/.emscripten file)
  - ./emsdk activate latest
  # Activate PATH and other environment variables in the current terminal
  - source ./emsdk_env.sh
  - cd ..
  - git clone https://github.com/VirusTotal/yara.git yara-source
  - cd yara-source
  - ./bootstrap.sh
  # Run emconfigure with the normal configure command as an argument.
  - emconfigure ./configure
  # Run emmake with the normal make to generate linked LLVM bitcode.
  - emmake make
  # Compile the linked bitcode generated by make (project.bc) to JavaScript.
  #  'project.bc' should be replaced with the make output for your project (e.g. 'yourproject.so')
  #  [-Ox] represents build optimisations (discussed in the next section).
  - /emcc [-Ox] yara.so -o yara.js